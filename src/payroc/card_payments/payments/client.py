# This file was auto-generated by Fern from our API Definition.

import datetime as dt
import typing

from ...core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ...core.custom_pagination import AsyncPayrocPager, SyncPayrocPager
from ...core.request_options import RequestOptions
from ...types.custom_field import CustomField
from ...types.customer import Customer
from ...types.ip_address import IpAddress
from ...types.itemized_breakdown_request import ItemizedBreakdownRequest
from ...types.offline_processing import OfflineProcessing
from ...types.payment import Payment
from ...types.payment_order_request import PaymentOrderRequest
from ...types.payment_paginated_list_for_read import PaymentPaginatedListForRead
from ...types.retrieved_payment import RetrievedPayment
from ...types.schemas_credential_on_file import SchemasCredentialOnFile
from .raw_client import AsyncRawPaymentsClient, RawPaymentsClient
from .types.list_payments_request_settlement_state import ListPaymentsRequestSettlementState
from .types.list_payments_request_status_item import ListPaymentsRequestStatusItem
from .types.list_payments_request_tender import ListPaymentsRequestTender
from .types.list_payments_request_tip_mode_item import ListPaymentsRequestTipModeItem
from .types.list_payments_request_type_item import ListPaymentsRequestTypeItem
from .types.payment_adjustment_adjustments_item import PaymentAdjustmentAdjustmentsItem
from .types.payment_request_channel import PaymentRequestChannel
from .types.payment_request_payment_method import PaymentRequestPaymentMethod
from .types.payment_request_three_d_secure import PaymentRequestThreeDSecure

# this is used as the default value for optional parameters
OMIT = typing.cast(typing.Any, ...)


class PaymentsClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawPaymentsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> RawPaymentsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawPaymentsClient
        """
        return self._raw_client

    def list(
        self,
        *,
        processing_terminal_id: typing.Optional[str] = None,
        order_id: typing.Optional[str] = None,
        operator: typing.Optional[str] = None,
        cardholder_name: typing.Optional[str] = None,
        first_6: typing.Optional[str] = None,
        last_4: typing.Optional[str] = None,
        tender: typing.Optional[ListPaymentsRequestTender] = None,
        tip_mode: typing.Optional[
            typing.Union[ListPaymentsRequestTipModeItem, typing.Sequence[ListPaymentsRequestTipModeItem]]
        ] = None,
        type: typing.Optional[
            typing.Union[ListPaymentsRequestTypeItem, typing.Sequence[ListPaymentsRequestTypeItem]]
        ] = None,
        status: typing.Optional[
            typing.Union[ListPaymentsRequestStatusItem, typing.Sequence[ListPaymentsRequestStatusItem]]
        ] = None,
        date_from: typing.Optional[dt.datetime] = None,
        date_to: typing.Optional[dt.datetime] = None,
        settlement_state: typing.Optional[ListPaymentsRequestSettlementState] = None,
        settlement_date: typing.Optional[dt.date] = None,
        payment_link_id: typing.Optional[str] = None,
        before: typing.Optional[str] = None,
        after: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SyncPayrocPager[RetrievedPayment, PaymentPaginatedListForRead]:
        """
        Use this method to return a [paginated](https://docs.payroc.com/api/pagination) list of payments.

        **Note:** If you want to view the details of a specific payment and you have its paymentId, use our [Retrieve Payment](https://docs.payroc.com/api/schema/card-payments/payments/retrieve) method.

        Use query parameters to filter the list of results that we return, for example, to search for payments for a customer, a tip mode, or a date range.

        Our gateway returns the following information about each payment in the list:

        - Order details, including the transaction amount and when it was processed.
        - Payment card details, including the masked card number, expiry date, and payment method.
        - Cardholder details, including their contact information and shipping address.
        - Payment details, including the payment type, status, and response.

        For each transaction, we also return the paymentId and an optional secureTokenId, which you can use to perform follow-on actions.

        Parameters
        ----------
        processing_terminal_id : typing.Optional[str]
            Filter by terminal ID.

        order_id : typing.Optional[str]
            Filter payments by order ID.

        operator : typing.Optional[str]
            Filter payments by operator.

        cardholder_name : typing.Optional[str]
            Filter payments by the cardholder’s name.

        first_6 : typing.Optional[str]
            Filter payments by the first six digits of the card number that the customer used in the transaction.

        last_4 : typing.Optional[str]
            Filter payments by the last four digits of the card number that the customer used in the transaction.

        tender : typing.Optional[ListPaymentsRequestTender]
            Filter by tender type.

        tip_mode : typing.Optional[typing.Union[ListPaymentsRequestTipModeItem, typing.Sequence[ListPaymentsRequestTipModeItem]]]
            Filter payments by tip.

        type : typing.Optional[typing.Union[ListPaymentsRequestTypeItem, typing.Sequence[ListPaymentsRequestTypeItem]]]
            Filter payments by transaction type.

        status : typing.Optional[typing.Union[ListPaymentsRequestStatusItem, typing.Sequence[ListPaymentsRequestStatusItem]]]
            Filter payments by the status of the transaction.

        date_from : typing.Optional[dt.datetime]
            Filter by payments that the processor processed after a specific date. The date format follows the ISO 8601 standard.

        date_to : typing.Optional[dt.datetime]
            Filter by payments that the processer processed before a specific date. The date format follows the ISO 8601 standard.

        settlement_state : typing.Optional[ListPaymentsRequestSettlementState]
            Filter payments by the settlement status of the transaction.

        settlement_date : typing.Optional[dt.date]
            Filter by payments that the processor settled on a specific date in the format **YYYY-MM-DD**.

        payment_link_id : typing.Optional[str]
            Unique identifier that our gateway assigned to the payment link.

        before : typing.Optional[str]
            Return the previous page of results before the value that you specify.

            You can’t send the before parameter in the same request as the after parameter.

        after : typing.Optional[str]
            Return the next page of results after the value that you specify.

            You can’t send the after parameter in the same request as the before parameter.

        limit : typing.Optional[int]
            Limit the maximum number of results that we return for each page.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SyncPayrocPager[RetrievedPayment, PaymentPaginatedListForRead]
            Successful request. Returns a list of payments.

        Examples
        --------
        import datetime

        from payroc import Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        response = client.card_payments.payments.list(
            processing_terminal_id="1234001",
            order_id="OrderRef6543",
            operator="Jane",
            cardholder_name="Sarah%20Hazel%20Hopper",
            first_6="453985",
            last_4="7062",
            tender="ebt",
            date_from=datetime.datetime.fromisoformat(
                "2024-07-01 15:30:00+00:00",
            ),
            date_to=datetime.datetime.fromisoformat(
                "2024-07-03 15:30:00+00:00",
            ),
            settlement_state="settled",
            settlement_date=datetime.date.fromisoformat(
                "2024-07-02",
            ),
            payment_link_id="JZURRJBUPS",
            before="2571",
            after="8516",
            limit=1,
        )
        for item in response:
            yield item
        # alternatively, you can paginate page-by-page
        for page in response.iter_pages():
            yield page
        """
        return self._raw_client.list(
            processing_terminal_id=processing_terminal_id,
            order_id=order_id,
            operator=operator,
            cardholder_name=cardholder_name,
            first_6=first_6,
            last_4=last_4,
            tender=tender,
            tip_mode=tip_mode,
            type=type,
            status=status,
            date_from=date_from,
            date_to=date_to,
            settlement_state=settlement_state,
            settlement_date=settlement_date,
            payment_link_id=payment_link_id,
            before=before,
            after=after,
            limit=limit,
            request_options=request_options,
        )

    def create(
        self,
        *,
        idempotency_key: str,
        channel: PaymentRequestChannel,
        processing_terminal_id: str,
        order: PaymentOrderRequest,
        payment_method: PaymentRequestPaymentMethod,
        operator: typing.Optional[str] = OMIT,
        customer: typing.Optional[Customer] = OMIT,
        ip_address: typing.Optional[IpAddress] = OMIT,
        three_d_secure: typing.Optional[PaymentRequestThreeDSecure] = OMIT,
        credential_on_file: typing.Optional[SchemasCredentialOnFile] = OMIT,
        offline_processing: typing.Optional[OfflineProcessing] = OMIT,
        auto_capture: typing.Optional[bool] = OMIT,
        process_as_sale: typing.Optional[bool] = OMIT,
        custom_fields: typing.Optional[typing.Sequence[CustomField]] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Payment:
        """
        Use this method to run a sale or a pre-authorization with a customer's payment card.

        In the response, our gateway returns information about the card payment and a paymentId, which you need for the following methods:

        -    [Retrieve payment](https://docs.payroc.com/api/schema/card-payments/payments/retrieve) - View the details of the card payment.
        -    [Adjust payment](https://docs.payroc.com/api/schema/card-payments/payments/adjust) - Update the details of the card payment.
        -    [Capture payment](https://docs.payroc.com/api/schema/card-payments/payments/capture)  - Capture the pre-authorization.
        -    [Reverse payment](https://docs.payroc.com/api/schema/card-payments/refunds/reverse)  - Cancel the card payment if it's in an open batch.
        -    [Refund payment](https://docs.payroc.com/api/schema/card-payments/refunds/create-referenced-refund)  - Run a referenced refund to return funds to the payment card.

        **Payment methods**

        - **Cards** - Credit, debit, and EBT
        - **Digital wallets** - [Apple Pay®](https://docs.payroc.com/guides/take-payments/apple-pay) and [Google Pay®](https://docs.payroc.com/guides/take-payments/google-pay)
        - **Tokens** - Secure tokens and single-use tokens

        **Features**

        Our Create Payment method also supports the following features:

        - [Repeat payments](https://docs.payroc.com/guides/take-payments/repeat-payments/use-your-own-software) - Run multiple payments as part of a payment schedule that you manage with your own software.
        - **Offline sales** - Run a sale or a pre-authorization if the terminal loses its connection to our gateway.
        - [Tokenization](https://docs.payroc.com/guides/take-payments/save-payment-details) - Save card details to use in future transactions.
        - [3-D Secure](https://docs.payroc.com/guides/take-payments/3-d-secure) - Verify the identity of the cardholder.
        - [Custom fields](https://docs.payroc.com/guides/take-payments/add-custom-fields) - Add your own data to a payment.
        - **Tips** - Add tips to the card payment.
        - **Taxes** - Add local taxes to the card payment.
        - **Surcharging** - Add a surcharge to the card payment.
        - **Dual pricing** - Offer different prices based on payment method, for example, if you use our RewardPay Choice pricing program.

        Parameters
        ----------
        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        channel : PaymentRequestChannel
            Channel that the merchant used to receive the payment details.

        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        order : PaymentOrderRequest

        payment_method : PaymentRequestPaymentMethod
            Polymorphic object that contains payment details.

            The value of the type parameter determines which variant you should use:
            -    `card` - Payment card details
            -    `secureToken` - Secure token details
            -    `digitalWallet` - Digital wallet details
            -    `singleUseToken` - Single-use token details

        operator : typing.Optional[str]
            Operator who ran the transaction.

        customer : typing.Optional[Customer]

        ip_address : typing.Optional[IpAddress]

        three_d_secure : typing.Optional[PaymentRequestThreeDSecure]
            Polymorphic object that contains authentication information from 3-D Secure.

            The value of the serviceProvider parameter determines which variant you should use:
            -    `gateway` - Use our gateway to run a 3-D Secure check.
            -    `thirdParty` - Use a third party to run a 3-D Secure check.

        credential_on_file : typing.Optional[SchemasCredentialOnFile]

        offline_processing : typing.Optional[OfflineProcessing]

        auto_capture : typing.Optional[bool]
            Indicates if we should automatically capture the payment amount.

            - `true` - Run a sale and automatically capture the transaction.
            - `false`- Run a pre-authorization and capture the transaction later.

            **Note:** If you send `false` and the terminal doesn't support pre-authorization, we set the transaction's status to pending. The merchant must capture the transaction to take payment from the customer.

        process_as_sale : typing.Optional[bool]
            Indicates if we should immediately settle the sale transaction. The merchant cannot adjust the transaction if we immediately settle it.
            **Note:** If the value for **processAsSale** is `true`, the gateway ignores the value in **autoCapture**.

        custom_fields : typing.Optional[typing.Sequence[CustomField]]
            Array of customField objects.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Payment
            Successful request. We processed the transaction.

        Examples
        --------
        from payroc import (
            Address,
            CardPayloadCardDetails_Raw,
            Customer,
            CustomField,
            Device,
            PaymentOrderRequest,
            Payroc,
            Shipping,
        )
        from payroc.card_payments.payments import PaymentRequestPaymentMethod_Card

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.card_payments.payments.create(
            idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
            channel="web",
            processing_terminal_id="1234001",
            operator="Jane",
            order=PaymentOrderRequest(
                order_id="OrderRef6543",
                description="Large Pepperoni Pizza",
                amount=4999,
                currency="USD",
            ),
            customer=Customer(
                first_name="Sarah",
                last_name="Hopper",
                billing_address=Address(
                    address_1="1 Example Ave.",
                    address_2="Example Address Line 2",
                    address_3="Example Address Line 3",
                    city="Chicago",
                    state="Illinois",
                    country="US",
                    postal_code="60056",
                ),
                shipping_address=Shipping(
                    recipient_name="Sarah Hopper",
                    address=Address(
                        address_1="1 Example Ave.",
                        address_2="Example Address Line 2",
                        address_3="Example Address Line 3",
                        city="Chicago",
                        state="Illinois",
                        country="US",
                        postal_code="60056",
                    ),
                ),
            ),
            payment_method=PaymentRequestPaymentMethod_Card(
                card_details=CardPayloadCardDetails_Raw(
                    device=Device(
                        model="bbposChp",
                        serial_number="1850010868",
                    ),
                    raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                ),
            ),
            custom_fields=[
                CustomField(
                    name="yourCustomField",
                    value="abc123",
                )
            ],
        )
        """
        _response = self._raw_client.create(
            idempotency_key=idempotency_key,
            channel=channel,
            processing_terminal_id=processing_terminal_id,
            order=order,
            payment_method=payment_method,
            operator=operator,
            customer=customer,
            ip_address=ip_address,
            three_d_secure=three_d_secure,
            credential_on_file=credential_on_file,
            offline_processing=offline_processing,
            auto_capture=auto_capture,
            process_as_sale=process_as_sale,
            custom_fields=custom_fields,
            request_options=request_options,
        )
        return _response.data

    def retrieve(self, payment_id: str, *, request_options: typing.Optional[RequestOptions] = None) -> RetrievedPayment:
        """
        Use this method to retrieve information about a card payment.

        To retrieve a payment, you need its paymentId. Our gateway returned the paymentId in the response of the [Create Payment](https://docs.payroc.com/api/schema/card-payments/payments/create) method.

        **Note:** If you don't have the paymentId, use our [List Payments](https://docs.payroc.com/api/schema/card-payments/payments/list) method to search for the payment.

        Our gateway returns the following information about the payment:

        - Order details, including the transaction amount and when it was processed.
        - Payment card details, including the masked card number, expiry date, and payment method.
        - Cardholder details, including their contact information and shipping address.
        - Payment details, including the payment type, status, and response.

        If the merchant saved the customer's card details, our gateway returns a secureTokenID, which you can use to perform follow-on actions.

        Parameters
        ----------
        payment_id : str
            Unique identifier of the payment that the merchant wants to retrieve.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        RetrievedPayment
            Successful request. Returns the payment.

        Examples
        --------
        from payroc import Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.card_payments.payments.retrieve(
            payment_id="M2MJOG6O2Y",
        )
        """
        _response = self._raw_client.retrieve(payment_id, request_options=request_options)
        return _response.data

    def adjust(
        self,
        payment_id: str,
        *,
        idempotency_key: str,
        adjustments: typing.Sequence[PaymentAdjustmentAdjustmentsItem],
        operator: typing.Optional[str] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Payment:
        """
        Use this method to adjust a payment in an open batch.

        To adjust a payment, you need its paymentId. Our gateway returned the paymentId in the response of the [Create Payment](https://docs.payroc.com/api/schema/card-payments/payments/create) method.

        **Note:** If you don't have the paymentId, use our [List Payments](https://docs.payroc.com/api/schema/card-payments/payments/list) method to search for the payment.

        You can adjust the following details of the payment:
        - Sale amount and tip amount
        - Payment status
        - Cardholder shipping address and contact information
        - Cardholder signature data

        Our gateway returns information about the adjusted payment, including information about the payment card and the cardholder.

        Parameters
        ----------
        payment_id : str
            Unique identifier of the payment that the merchant wants to retrieve.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        adjustments : typing.Sequence[PaymentAdjustmentAdjustmentsItem]
            Array of polymorphic objects which contain information about adjustments to a payment.

            The value of the type parameter determines which variant you should use:
            -    `order` - Tip information.
            -    `status` - Status of the transaction.
            -    `customer` - Customer's contact information and shipping address.
            -    `signature` - Customer's signature.

        operator : typing.Optional[str]
            Operator who adjusted the payment.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Payment
            Successful request. We adjusted the transaction.

        Examples
        --------
        from payroc import Payroc
        from payroc.card_payments.payments import (
            PaymentAdjustmentAdjustmentsItem_Customer,
            PaymentAdjustmentAdjustmentsItem_Order,
        )

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.card_payments.payments.adjust(
            payment_id="M2MJOG6O2Y",
            idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
            adjustments=[
                PaymentAdjustmentAdjustmentsItem_Customer(),
                PaymentAdjustmentAdjustmentsItem_Order(
                    amount=4999,
                ),
            ],
        )
        """
        _response = self._raw_client.adjust(
            payment_id,
            idempotency_key=idempotency_key,
            adjustments=adjustments,
            operator=operator,
            request_options=request_options,
        )
        return _response.data

    def capture(
        self,
        payment_id: str,
        *,
        idempotency_key: str,
        processing_terminal_id: typing.Optional[str] = OMIT,
        operator: typing.Optional[str] = OMIT,
        amount: typing.Optional[int] = OMIT,
        breakdown: typing.Optional[ItemizedBreakdownRequest] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Payment:
        """
        Use this method to capture a pre-authorization.

        To capture a pre-authorization, you need its paymentId. Our gateway returned the paymentId in the response of the [Create Payment](https://docs.payroc.com/api/schema/card-payments/payments/create) method.

        **Note:** If you don't have the paymentId, use our [List Payments](https://docs.payroc.com/api/schema/card-payments/payments/list) method to search for the payment.

        Depending on the amount you want to capture, complete the following:
        -    **Capture the full amount of the pre-authorization** - Don't send a value for the amount parameter in your request.
        -    **Capture less than the amount of the pre-authorization** - Send a value for the amount parameter in your request.
        -    **Capture more than the amount of the pre-authorization** - Adjust the pre-authorization before you capture it. For more information about adjusting a pre-authorization, go to [Adjust Payment](https://docs.payroc.com/api/schema/card-payments/payments/adjust).

        If your request is successful, our gateway takes the amount from the payment card.

        **Note:** For more information about pre-authorizations and captures, go to [Run a pre-authorization](https://docs.payroc.com/guides/integrate/run-a-pre-authorization).

        Parameters
        ----------
        payment_id : str
            Unique identifier of the payment that the merchant wants to retrieve.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        processing_terminal_id : typing.Optional[str]
            Unique identifier that our gateway assigned to the terminal.

        operator : typing.Optional[str]
            Operator who captured the payment.

        amount : typing.Optional[int]
            Amount that the merchant wants to capture. The value is in the currency's lowest denomination, for example, cents.
            **Note:** If the merchant does not send an amount, we capture the total amount of the transaction.

        breakdown : typing.Optional[ItemizedBreakdownRequest]

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Payment
            Successful request. We captured the payment.

        Examples
        --------
        from payroc import ItemizedBreakdownRequest, LineItemRequest, Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.card_payments.payments.capture(
            payment_id="M2MJOG6O2Y",
            idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
            processing_terminal_id="1234001",
            operator="Jane",
            amount=4999,
            breakdown=ItemizedBreakdownRequest(
                subtotal=4999,
                duty_amount=499,
                freight_amount=500,
                items=[
                    LineItemRequest(
                        unit_price=4000,
                        quantity=1.0,
                    )
                ],
            ),
        )
        """
        _response = self._raw_client.capture(
            payment_id,
            idempotency_key=idempotency_key,
            processing_terminal_id=processing_terminal_id,
            operator=operator,
            amount=amount,
            breakdown=breakdown,
            request_options=request_options,
        )
        return _response.data


class AsyncPaymentsClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawPaymentsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> AsyncRawPaymentsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawPaymentsClient
        """
        return self._raw_client

    async def list(
        self,
        *,
        processing_terminal_id: typing.Optional[str] = None,
        order_id: typing.Optional[str] = None,
        operator: typing.Optional[str] = None,
        cardholder_name: typing.Optional[str] = None,
        first_6: typing.Optional[str] = None,
        last_4: typing.Optional[str] = None,
        tender: typing.Optional[ListPaymentsRequestTender] = None,
        tip_mode: typing.Optional[
            typing.Union[ListPaymentsRequestTipModeItem, typing.Sequence[ListPaymentsRequestTipModeItem]]
        ] = None,
        type: typing.Optional[
            typing.Union[ListPaymentsRequestTypeItem, typing.Sequence[ListPaymentsRequestTypeItem]]
        ] = None,
        status: typing.Optional[
            typing.Union[ListPaymentsRequestStatusItem, typing.Sequence[ListPaymentsRequestStatusItem]]
        ] = None,
        date_from: typing.Optional[dt.datetime] = None,
        date_to: typing.Optional[dt.datetime] = None,
        settlement_state: typing.Optional[ListPaymentsRequestSettlementState] = None,
        settlement_date: typing.Optional[dt.date] = None,
        payment_link_id: typing.Optional[str] = None,
        before: typing.Optional[str] = None,
        after: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> AsyncPayrocPager[RetrievedPayment, PaymentPaginatedListForRead]:
        """
        Use this method to return a [paginated](https://docs.payroc.com/api/pagination) list of payments.

        **Note:** If you want to view the details of a specific payment and you have its paymentId, use our [Retrieve Payment](https://docs.payroc.com/api/schema/card-payments/payments/retrieve) method.

        Use query parameters to filter the list of results that we return, for example, to search for payments for a customer, a tip mode, or a date range.

        Our gateway returns the following information about each payment in the list:

        - Order details, including the transaction amount and when it was processed.
        - Payment card details, including the masked card number, expiry date, and payment method.
        - Cardholder details, including their contact information and shipping address.
        - Payment details, including the payment type, status, and response.

        For each transaction, we also return the paymentId and an optional secureTokenId, which you can use to perform follow-on actions.

        Parameters
        ----------
        processing_terminal_id : typing.Optional[str]
            Filter by terminal ID.

        order_id : typing.Optional[str]
            Filter payments by order ID.

        operator : typing.Optional[str]
            Filter payments by operator.

        cardholder_name : typing.Optional[str]
            Filter payments by the cardholder’s name.

        first_6 : typing.Optional[str]
            Filter payments by the first six digits of the card number that the customer used in the transaction.

        last_4 : typing.Optional[str]
            Filter payments by the last four digits of the card number that the customer used in the transaction.

        tender : typing.Optional[ListPaymentsRequestTender]
            Filter by tender type.

        tip_mode : typing.Optional[typing.Union[ListPaymentsRequestTipModeItem, typing.Sequence[ListPaymentsRequestTipModeItem]]]
            Filter payments by tip.

        type : typing.Optional[typing.Union[ListPaymentsRequestTypeItem, typing.Sequence[ListPaymentsRequestTypeItem]]]
            Filter payments by transaction type.

        status : typing.Optional[typing.Union[ListPaymentsRequestStatusItem, typing.Sequence[ListPaymentsRequestStatusItem]]]
            Filter payments by the status of the transaction.

        date_from : typing.Optional[dt.datetime]
            Filter by payments that the processor processed after a specific date. The date format follows the ISO 8601 standard.

        date_to : typing.Optional[dt.datetime]
            Filter by payments that the processer processed before a specific date. The date format follows the ISO 8601 standard.

        settlement_state : typing.Optional[ListPaymentsRequestSettlementState]
            Filter payments by the settlement status of the transaction.

        settlement_date : typing.Optional[dt.date]
            Filter by payments that the processor settled on a specific date in the format **YYYY-MM-DD**.

        payment_link_id : typing.Optional[str]
            Unique identifier that our gateway assigned to the payment link.

        before : typing.Optional[str]
            Return the previous page of results before the value that you specify.

            You can’t send the before parameter in the same request as the after parameter.

        after : typing.Optional[str]
            Return the next page of results after the value that you specify.

            You can’t send the after parameter in the same request as the before parameter.

        limit : typing.Optional[int]
            Limit the maximum number of results that we return for each page.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        AsyncPayrocPager[RetrievedPayment, PaymentPaginatedListForRead]
            Successful request. Returns a list of payments.

        Examples
        --------
        import asyncio
        import datetime

        from payroc import AsyncPayroc

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            response = await client.card_payments.payments.list(
                processing_terminal_id="1234001",
                order_id="OrderRef6543",
                operator="Jane",
                cardholder_name="Sarah%20Hazel%20Hopper",
                first_6="453985",
                last_4="7062",
                tender="ebt",
                date_from=datetime.datetime.fromisoformat(
                    "2024-07-01 15:30:00+00:00",
                ),
                date_to=datetime.datetime.fromisoformat(
                    "2024-07-03 15:30:00+00:00",
                ),
                settlement_state="settled",
                settlement_date=datetime.date.fromisoformat(
                    "2024-07-02",
                ),
                payment_link_id="JZURRJBUPS",
                before="2571",
                after="8516",
                limit=1,
            )
            async for item in response:
                yield item

            # alternatively, you can paginate page-by-page
            async for page in response.iter_pages():
                yield page


        asyncio.run(main())
        """
        return await self._raw_client.list(
            processing_terminal_id=processing_terminal_id,
            order_id=order_id,
            operator=operator,
            cardholder_name=cardholder_name,
            first_6=first_6,
            last_4=last_4,
            tender=tender,
            tip_mode=tip_mode,
            type=type,
            status=status,
            date_from=date_from,
            date_to=date_to,
            settlement_state=settlement_state,
            settlement_date=settlement_date,
            payment_link_id=payment_link_id,
            before=before,
            after=after,
            limit=limit,
            request_options=request_options,
        )

    async def create(
        self,
        *,
        idempotency_key: str,
        channel: PaymentRequestChannel,
        processing_terminal_id: str,
        order: PaymentOrderRequest,
        payment_method: PaymentRequestPaymentMethod,
        operator: typing.Optional[str] = OMIT,
        customer: typing.Optional[Customer] = OMIT,
        ip_address: typing.Optional[IpAddress] = OMIT,
        three_d_secure: typing.Optional[PaymentRequestThreeDSecure] = OMIT,
        credential_on_file: typing.Optional[SchemasCredentialOnFile] = OMIT,
        offline_processing: typing.Optional[OfflineProcessing] = OMIT,
        auto_capture: typing.Optional[bool] = OMIT,
        process_as_sale: typing.Optional[bool] = OMIT,
        custom_fields: typing.Optional[typing.Sequence[CustomField]] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Payment:
        """
        Use this method to run a sale or a pre-authorization with a customer's payment card.

        In the response, our gateway returns information about the card payment and a paymentId, which you need for the following methods:

        -    [Retrieve payment](https://docs.payroc.com/api/schema/card-payments/payments/retrieve) - View the details of the card payment.
        -    [Adjust payment](https://docs.payroc.com/api/schema/card-payments/payments/adjust) - Update the details of the card payment.
        -    [Capture payment](https://docs.payroc.com/api/schema/card-payments/payments/capture)  - Capture the pre-authorization.
        -    [Reverse payment](https://docs.payroc.com/api/schema/card-payments/refunds/reverse)  - Cancel the card payment if it's in an open batch.
        -    [Refund payment](https://docs.payroc.com/api/schema/card-payments/refunds/create-referenced-refund)  - Run a referenced refund to return funds to the payment card.

        **Payment methods**

        - **Cards** - Credit, debit, and EBT
        - **Digital wallets** - [Apple Pay®](https://docs.payroc.com/guides/take-payments/apple-pay) and [Google Pay®](https://docs.payroc.com/guides/take-payments/google-pay)
        - **Tokens** - Secure tokens and single-use tokens

        **Features**

        Our Create Payment method also supports the following features:

        - [Repeat payments](https://docs.payroc.com/guides/take-payments/repeat-payments/use-your-own-software) - Run multiple payments as part of a payment schedule that you manage with your own software.
        - **Offline sales** - Run a sale or a pre-authorization if the terminal loses its connection to our gateway.
        - [Tokenization](https://docs.payroc.com/guides/take-payments/save-payment-details) - Save card details to use in future transactions.
        - [3-D Secure](https://docs.payroc.com/guides/take-payments/3-d-secure) - Verify the identity of the cardholder.
        - [Custom fields](https://docs.payroc.com/guides/take-payments/add-custom-fields) - Add your own data to a payment.
        - **Tips** - Add tips to the card payment.
        - **Taxes** - Add local taxes to the card payment.
        - **Surcharging** - Add a surcharge to the card payment.
        - **Dual pricing** - Offer different prices based on payment method, for example, if you use our RewardPay Choice pricing program.

        Parameters
        ----------
        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        channel : PaymentRequestChannel
            Channel that the merchant used to receive the payment details.

        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        order : PaymentOrderRequest

        payment_method : PaymentRequestPaymentMethod
            Polymorphic object that contains payment details.

            The value of the type parameter determines which variant you should use:
            -    `card` - Payment card details
            -    `secureToken` - Secure token details
            -    `digitalWallet` - Digital wallet details
            -    `singleUseToken` - Single-use token details

        operator : typing.Optional[str]
            Operator who ran the transaction.

        customer : typing.Optional[Customer]

        ip_address : typing.Optional[IpAddress]

        three_d_secure : typing.Optional[PaymentRequestThreeDSecure]
            Polymorphic object that contains authentication information from 3-D Secure.

            The value of the serviceProvider parameter determines which variant you should use:
            -    `gateway` - Use our gateway to run a 3-D Secure check.
            -    `thirdParty` - Use a third party to run a 3-D Secure check.

        credential_on_file : typing.Optional[SchemasCredentialOnFile]

        offline_processing : typing.Optional[OfflineProcessing]

        auto_capture : typing.Optional[bool]
            Indicates if we should automatically capture the payment amount.

            - `true` - Run a sale and automatically capture the transaction.
            - `false`- Run a pre-authorization and capture the transaction later.

            **Note:** If you send `false` and the terminal doesn't support pre-authorization, we set the transaction's status to pending. The merchant must capture the transaction to take payment from the customer.

        process_as_sale : typing.Optional[bool]
            Indicates if we should immediately settle the sale transaction. The merchant cannot adjust the transaction if we immediately settle it.
            **Note:** If the value for **processAsSale** is `true`, the gateway ignores the value in **autoCapture**.

        custom_fields : typing.Optional[typing.Sequence[CustomField]]
            Array of customField objects.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Payment
            Successful request. We processed the transaction.

        Examples
        --------
        import asyncio

        from payroc import (
            Address,
            AsyncPayroc,
            CardPayloadCardDetails_Raw,
            Customer,
            CustomField,
            Device,
            PaymentOrderRequest,
            Shipping,
        )
        from payroc.card_payments.payments import PaymentRequestPaymentMethod_Card

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.card_payments.payments.create(
                idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
                channel="web",
                processing_terminal_id="1234001",
                operator="Jane",
                order=PaymentOrderRequest(
                    order_id="OrderRef6543",
                    description="Large Pepperoni Pizza",
                    amount=4999,
                    currency="USD",
                ),
                customer=Customer(
                    first_name="Sarah",
                    last_name="Hopper",
                    billing_address=Address(
                        address_1="1 Example Ave.",
                        address_2="Example Address Line 2",
                        address_3="Example Address Line 3",
                        city="Chicago",
                        state="Illinois",
                        country="US",
                        postal_code="60056",
                    ),
                    shipping_address=Shipping(
                        recipient_name="Sarah Hopper",
                        address=Address(
                            address_1="1 Example Ave.",
                            address_2="Example Address Line 2",
                            address_3="Example Address Line 3",
                            city="Chicago",
                            state="Illinois",
                            country="US",
                            postal_code="60056",
                        ),
                    ),
                ),
                payment_method=PaymentRequestPaymentMethod_Card(
                    card_details=CardPayloadCardDetails_Raw(
                        device=Device(
                            model="bbposChp",
                            serial_number="1850010868",
                        ),
                        raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                    ),
                ),
                custom_fields=[
                    CustomField(
                        name="yourCustomField",
                        value="abc123",
                    )
                ],
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.create(
            idempotency_key=idempotency_key,
            channel=channel,
            processing_terminal_id=processing_terminal_id,
            order=order,
            payment_method=payment_method,
            operator=operator,
            customer=customer,
            ip_address=ip_address,
            three_d_secure=three_d_secure,
            credential_on_file=credential_on_file,
            offline_processing=offline_processing,
            auto_capture=auto_capture,
            process_as_sale=process_as_sale,
            custom_fields=custom_fields,
            request_options=request_options,
        )
        return _response.data

    async def retrieve(
        self, payment_id: str, *, request_options: typing.Optional[RequestOptions] = None
    ) -> RetrievedPayment:
        """
        Use this method to retrieve information about a card payment.

        To retrieve a payment, you need its paymentId. Our gateway returned the paymentId in the response of the [Create Payment](https://docs.payroc.com/api/schema/card-payments/payments/create) method.

        **Note:** If you don't have the paymentId, use our [List Payments](https://docs.payroc.com/api/schema/card-payments/payments/list) method to search for the payment.

        Our gateway returns the following information about the payment:

        - Order details, including the transaction amount and when it was processed.
        - Payment card details, including the masked card number, expiry date, and payment method.
        - Cardholder details, including their contact information and shipping address.
        - Payment details, including the payment type, status, and response.

        If the merchant saved the customer's card details, our gateway returns a secureTokenID, which you can use to perform follow-on actions.

        Parameters
        ----------
        payment_id : str
            Unique identifier of the payment that the merchant wants to retrieve.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        RetrievedPayment
            Successful request. Returns the payment.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.card_payments.payments.retrieve(
                payment_id="M2MJOG6O2Y",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.retrieve(payment_id, request_options=request_options)
        return _response.data

    async def adjust(
        self,
        payment_id: str,
        *,
        idempotency_key: str,
        adjustments: typing.Sequence[PaymentAdjustmentAdjustmentsItem],
        operator: typing.Optional[str] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Payment:
        """
        Use this method to adjust a payment in an open batch.

        To adjust a payment, you need its paymentId. Our gateway returned the paymentId in the response of the [Create Payment](https://docs.payroc.com/api/schema/card-payments/payments/create) method.

        **Note:** If you don't have the paymentId, use our [List Payments](https://docs.payroc.com/api/schema/card-payments/payments/list) method to search for the payment.

        You can adjust the following details of the payment:
        - Sale amount and tip amount
        - Payment status
        - Cardholder shipping address and contact information
        - Cardholder signature data

        Our gateway returns information about the adjusted payment, including information about the payment card and the cardholder.

        Parameters
        ----------
        payment_id : str
            Unique identifier of the payment that the merchant wants to retrieve.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        adjustments : typing.Sequence[PaymentAdjustmentAdjustmentsItem]
            Array of polymorphic objects which contain information about adjustments to a payment.

            The value of the type parameter determines which variant you should use:
            -    `order` - Tip information.
            -    `status` - Status of the transaction.
            -    `customer` - Customer's contact information and shipping address.
            -    `signature` - Customer's signature.

        operator : typing.Optional[str]
            Operator who adjusted the payment.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Payment
            Successful request. We adjusted the transaction.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc
        from payroc.card_payments.payments import (
            PaymentAdjustmentAdjustmentsItem_Customer,
            PaymentAdjustmentAdjustmentsItem_Order,
        )

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.card_payments.payments.adjust(
                payment_id="M2MJOG6O2Y",
                idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
                adjustments=[
                    PaymentAdjustmentAdjustmentsItem_Customer(),
                    PaymentAdjustmentAdjustmentsItem_Order(
                        amount=4999,
                    ),
                ],
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.adjust(
            payment_id,
            idempotency_key=idempotency_key,
            adjustments=adjustments,
            operator=operator,
            request_options=request_options,
        )
        return _response.data

    async def capture(
        self,
        payment_id: str,
        *,
        idempotency_key: str,
        processing_terminal_id: typing.Optional[str] = OMIT,
        operator: typing.Optional[str] = OMIT,
        amount: typing.Optional[int] = OMIT,
        breakdown: typing.Optional[ItemizedBreakdownRequest] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Payment:
        """
        Use this method to capture a pre-authorization.

        To capture a pre-authorization, you need its paymentId. Our gateway returned the paymentId in the response of the [Create Payment](https://docs.payroc.com/api/schema/card-payments/payments/create) method.

        **Note:** If you don't have the paymentId, use our [List Payments](https://docs.payroc.com/api/schema/card-payments/payments/list) method to search for the payment.

        Depending on the amount you want to capture, complete the following:
        -    **Capture the full amount of the pre-authorization** - Don't send a value for the amount parameter in your request.
        -    **Capture less than the amount of the pre-authorization** - Send a value for the amount parameter in your request.
        -    **Capture more than the amount of the pre-authorization** - Adjust the pre-authorization before you capture it. For more information about adjusting a pre-authorization, go to [Adjust Payment](https://docs.payroc.com/api/schema/card-payments/payments/adjust).

        If your request is successful, our gateway takes the amount from the payment card.

        **Note:** For more information about pre-authorizations and captures, go to [Run a pre-authorization](https://docs.payroc.com/guides/integrate/run-a-pre-authorization).

        Parameters
        ----------
        payment_id : str
            Unique identifier of the payment that the merchant wants to retrieve.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        processing_terminal_id : typing.Optional[str]
            Unique identifier that our gateway assigned to the terminal.

        operator : typing.Optional[str]
            Operator who captured the payment.

        amount : typing.Optional[int]
            Amount that the merchant wants to capture. The value is in the currency's lowest denomination, for example, cents.
            **Note:** If the merchant does not send an amount, we capture the total amount of the transaction.

        breakdown : typing.Optional[ItemizedBreakdownRequest]

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Payment
            Successful request. We captured the payment.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc, ItemizedBreakdownRequest, LineItemRequest

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.card_payments.payments.capture(
                payment_id="M2MJOG6O2Y",
                idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
                processing_terminal_id="1234001",
                operator="Jane",
                amount=4999,
                breakdown=ItemizedBreakdownRequest(
                    subtotal=4999,
                    duty_amount=499,
                    freight_amount=500,
                    items=[
                        LineItemRequest(
                            unit_price=4000,
                            quantity=1.0,
                        )
                    ],
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.capture(
            payment_id,
            idempotency_key=idempotency_key,
            processing_terminal_id=processing_terminal_id,
            operator=operator,
            amount=amount,
            breakdown=breakdown,
            request_options=request_options,
        )
        return _response.data
