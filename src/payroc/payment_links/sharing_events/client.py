# This file was auto-generated by Fern from our API Definition.

import datetime as dt
import typing

from ...core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ...core.custom_pagination import AsyncPayrocPager, SyncPayrocPager
from ...core.request_options import RequestOptions
from ...types.payment_link_email_recipient import PaymentLinkEmailRecipient
from ...types.payment_link_email_share_event import PaymentLinkEmailShareEvent
from ...types.payment_link_email_share_event_sharing_method import PaymentLinkEmailShareEventSharingMethod
from ...types.sharing_event_paginated_list import SharingEventPaginatedList
from .raw_client import AsyncRawSharingEventsClient, RawSharingEventsClient

# this is used as the default value for optional parameters
OMIT = typing.cast(typing.Any, ...)


class SharingEventsClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawSharingEventsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> RawSharingEventsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawSharingEventsClient
        """
        return self._raw_client

    def list(
        self,
        payment_link_id: str,
        *,
        recipient_name: typing.Optional[str] = None,
        recipient_email: typing.Optional[str] = None,
        before: typing.Optional[str] = None,
        after: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SyncPayrocPager[PaymentLinkEmailShareEvent, SharingEventPaginatedList]:
        """
        Use this method to return a [paginated](https://docs.payroc.com/api/pagination) list of sharing events for a payment link. A sharing event occurs when a merchant shares a payment link with a customer.

        To list the sharing events for a payment link, you need its paymentLinkId. Our gateway returned the paymentLinkId in the response of the [Create Payment Link](https://docs.payroc.com/api/schema/payment-links/create) method.

        **Note:** If you don't have the paymentLinkId, use our [List Payment Links](https://docs.payroc.com/api/schema/payment-links/list) method to search for the payment link.

        Use query parameters to filter the list of results that we return, for example, to search for links sent to a specific customer.

        Our gateway returns the following information for each sharing event in the list:
        - Customer that the merchant sent the link to.
        - Date that the merchant sent the link.

        Parameters
        ----------
        payment_link_id : str
            Unique identifier that we assigned to the payment link.

        recipient_name : typing.Optional[str]
            Filter results by the customer's name.

        recipient_email : typing.Optional[str]
            Filter results by the customer's email address.

        before : typing.Optional[str]
            Return the previous page of results before the value that you specify.

            You can’t send the before parameter in the same request as the after parameter.

        after : typing.Optional[str]
            Return the next page of results after the value that you specify.

            You can’t send the after parameter in the same request as the before parameter.

        limit : typing.Optional[int]
            Limit the maximum number of results that we return for each page.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SyncPayrocPager[PaymentLinkEmailShareEvent, SharingEventPaginatedList]
            Successful request. Returns a [paginated](https://docs.payroc.com/api/pagination) list of sharing events for the payment link.

        Examples
        --------
        from payroc import Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        response = client.payment_links.sharing_events.list(
            payment_link_id="JZURRJBUPS",
            recipient_name="Sarah Hazel Hopper",
            recipient_email="sarah.hopper@example.com",
            before="2571",
            after="8516",
            limit=1,
        )
        for item in response:
            yield item
        # alternatively, you can paginate page-by-page
        for page in response.iter_pages():
            yield page
        """
        return self._raw_client.list(
            payment_link_id,
            recipient_name=recipient_name,
            recipient_email=recipient_email,
            before=before,
            after=after,
            limit=limit,
            request_options=request_options,
        )

    def share(
        self,
        payment_link_id: str,
        *,
        idempotency_key: str,
        sharing_method: PaymentLinkEmailShareEventSharingMethod,
        recipients: typing.Sequence[PaymentLinkEmailRecipient],
        sharing_event_id: typing.Optional[str] = OMIT,
        date_time: typing.Optional[dt.datetime] = OMIT,
        merchant_copy: typing.Optional[bool] = OMIT,
        message: typing.Optional[str] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> PaymentLinkEmailShareEvent:
        """
        Use this method to email a payment link to a customer.

        To email a payment link, you need its paymentLinkId. Our gateway returned the paymentLinkId in the response of the [Create Payment Link](https://docs.payroc.com/api/schema/payment-links/create) method.

        **Note:** If you don't have the paymentLinkId, use our [List Payment Links](https://docs.payroc.com/api/schema/payment-links/list) method to search for the payment link.

        In the request, you must provide the recipient's name and email address.

        In the response, our gateway returns a sharingEventId, which you can use to [List Payment Link Sharing Events](https://docs.payroc.com/api/schema/payment-links/sharing-events/list).

        Parameters
        ----------
        payment_link_id : str
            Unique identifier that we assigned to the payment link.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        sharing_method : PaymentLinkEmailShareEventSharingMethod
            Method that the merchant uses to share the payment link.

        recipients : typing.Sequence[PaymentLinkEmailRecipient]
            Array that contains the recipients of the payment link.

        sharing_event_id : typing.Optional[str]
            Unique identifier that we assigned to the sharing event.

        date_time : typing.Optional[dt.datetime]
            Date and time that the merchant shared the link. Our gateway returns this value in the [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) format.

        merchant_copy : typing.Optional[bool]
            Indicates if we send a copy of the email to the merchant. By default, we don't send a copy to the merchant.

        message : typing.Optional[str]
            Message that the merchant sends with the payment link.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        PaymentLinkEmailShareEvent
            Successful request. We return a polymorphic object that contains information about how the merchant shared a payment link.

        Examples
        --------
        from payroc import PaymentLinkEmailRecipient, Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.payment_links.sharing_events.share(
            payment_link_id="JZURRJBUPS",
            idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
            sharing_method="email",
            merchant_copy=True,
            message="Dear Sarah,\n\nYour insurance is expiring this month.\nPlease, pay the renewal fee by the end of the month to renew it.\n",
            recipients=[
                PaymentLinkEmailRecipient(
                    name="Sarah Hazel Hopper",
                    email="sarah.hopper@example.com",
                )
            ],
        )
        """
        _response = self._raw_client.share(
            payment_link_id,
            idempotency_key=idempotency_key,
            sharing_method=sharing_method,
            recipients=recipients,
            sharing_event_id=sharing_event_id,
            date_time=date_time,
            merchant_copy=merchant_copy,
            message=message,
            request_options=request_options,
        )
        return _response.data


class AsyncSharingEventsClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawSharingEventsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> AsyncRawSharingEventsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawSharingEventsClient
        """
        return self._raw_client

    async def list(
        self,
        payment_link_id: str,
        *,
        recipient_name: typing.Optional[str] = None,
        recipient_email: typing.Optional[str] = None,
        before: typing.Optional[str] = None,
        after: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> AsyncPayrocPager[PaymentLinkEmailShareEvent, SharingEventPaginatedList]:
        """
        Use this method to return a [paginated](https://docs.payroc.com/api/pagination) list of sharing events for a payment link. A sharing event occurs when a merchant shares a payment link with a customer.

        To list the sharing events for a payment link, you need its paymentLinkId. Our gateway returned the paymentLinkId in the response of the [Create Payment Link](https://docs.payroc.com/api/schema/payment-links/create) method.

        **Note:** If you don't have the paymentLinkId, use our [List Payment Links](https://docs.payroc.com/api/schema/payment-links/list) method to search for the payment link.

        Use query parameters to filter the list of results that we return, for example, to search for links sent to a specific customer.

        Our gateway returns the following information for each sharing event in the list:
        - Customer that the merchant sent the link to.
        - Date that the merchant sent the link.

        Parameters
        ----------
        payment_link_id : str
            Unique identifier that we assigned to the payment link.

        recipient_name : typing.Optional[str]
            Filter results by the customer's name.

        recipient_email : typing.Optional[str]
            Filter results by the customer's email address.

        before : typing.Optional[str]
            Return the previous page of results before the value that you specify.

            You can’t send the before parameter in the same request as the after parameter.

        after : typing.Optional[str]
            Return the next page of results after the value that you specify.

            You can’t send the after parameter in the same request as the before parameter.

        limit : typing.Optional[int]
            Limit the maximum number of results that we return for each page.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        AsyncPayrocPager[PaymentLinkEmailShareEvent, SharingEventPaginatedList]
            Successful request. Returns a [paginated](https://docs.payroc.com/api/pagination) list of sharing events for the payment link.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            response = await client.payment_links.sharing_events.list(
                payment_link_id="JZURRJBUPS",
                recipient_name="Sarah Hazel Hopper",
                recipient_email="sarah.hopper@example.com",
                before="2571",
                after="8516",
                limit=1,
            )
            async for item in response:
                yield item

            # alternatively, you can paginate page-by-page
            async for page in response.iter_pages():
                yield page


        asyncio.run(main())
        """
        return await self._raw_client.list(
            payment_link_id,
            recipient_name=recipient_name,
            recipient_email=recipient_email,
            before=before,
            after=after,
            limit=limit,
            request_options=request_options,
        )

    async def share(
        self,
        payment_link_id: str,
        *,
        idempotency_key: str,
        sharing_method: PaymentLinkEmailShareEventSharingMethod,
        recipients: typing.Sequence[PaymentLinkEmailRecipient],
        sharing_event_id: typing.Optional[str] = OMIT,
        date_time: typing.Optional[dt.datetime] = OMIT,
        merchant_copy: typing.Optional[bool] = OMIT,
        message: typing.Optional[str] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> PaymentLinkEmailShareEvent:
        """
        Use this method to email a payment link to a customer.

        To email a payment link, you need its paymentLinkId. Our gateway returned the paymentLinkId in the response of the [Create Payment Link](https://docs.payroc.com/api/schema/payment-links/create) method.

        **Note:** If you don't have the paymentLinkId, use our [List Payment Links](https://docs.payroc.com/api/schema/payment-links/list) method to search for the payment link.

        In the request, you must provide the recipient's name and email address.

        In the response, our gateway returns a sharingEventId, which you can use to [List Payment Link Sharing Events](https://docs.payroc.com/api/schema/payment-links/sharing-events/list).

        Parameters
        ----------
        payment_link_id : str
            Unique identifier that we assigned to the payment link.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        sharing_method : PaymentLinkEmailShareEventSharingMethod
            Method that the merchant uses to share the payment link.

        recipients : typing.Sequence[PaymentLinkEmailRecipient]
            Array that contains the recipients of the payment link.

        sharing_event_id : typing.Optional[str]
            Unique identifier that we assigned to the sharing event.

        date_time : typing.Optional[dt.datetime]
            Date and time that the merchant shared the link. Our gateway returns this value in the [ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html) format.

        merchant_copy : typing.Optional[bool]
            Indicates if we send a copy of the email to the merchant. By default, we don't send a copy to the merchant.

        message : typing.Optional[str]
            Message that the merchant sends with the payment link.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        PaymentLinkEmailShareEvent
            Successful request. We return a polymorphic object that contains information about how the merchant shared a payment link.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc, PaymentLinkEmailRecipient

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.payment_links.sharing_events.share(
                payment_link_id="JZURRJBUPS",
                idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
                sharing_method="email",
                merchant_copy=True,
                message="Dear Sarah,\n\nYour insurance is expiring this month.\nPlease, pay the renewal fee by the end of the month to renew it.\n",
                recipients=[
                    PaymentLinkEmailRecipient(
                        name="Sarah Hazel Hopper",
                        email="sarah.hopper@example.com",
                    )
                ],
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.share(
            payment_link_id,
            idempotency_key=idempotency_key,
            sharing_method=sharing_method,
            recipients=recipients,
            sharing_event_id=sharing_event_id,
            date_time=date_time,
            merchant_copy=merchant_copy,
            message=message,
            request_options=request_options,
        )
        return _response.data
