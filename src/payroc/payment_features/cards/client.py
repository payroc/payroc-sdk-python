# This file was auto-generated by Fern from our API Definition.

import typing

from ...core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ...core.request_options import RequestOptions
from ...types.balance import Balance
from ...types.card_info import CardInfo
from ...types.card_verification_result import CardVerificationResult
from ...types.currency import Currency
from ...types.customer import Customer
from ...types.fx_rate import FxRate
from .raw_client import AsyncRawCardsClient, RawCardsClient
from .types.balance_inquiry_card import BalanceInquiryCard
from .types.bin_lookup_card import BinLookupCard
from .types.card_verification_request_card import CardVerificationRequestCard
from .types.fx_rate_inquiry_channel import FxRateInquiryChannel
from .types.fx_rate_inquiry_payment_method import FxRateInquiryPaymentMethod

# this is used as the default value for optional parameters
OMIT = typing.cast(typing.Any, ...)


class CardsClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawCardsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> RawCardsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawCardsClient
        """
        return self._raw_client

    def verify_card(
        self,
        *,
        idempotency_key: str,
        processing_terminal_id: str,
        card: CardVerificationRequestCard,
        operator: typing.Optional[str] = OMIT,
        customer: typing.Optional[Customer] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> CardVerificationResult:
        """
        Use this method to verify a customer’s card details.

        In the request, send the customer’s card details.

        In the response, our gateway indicates if the card details are valid and if you should use them in follow-on actions.

        Parameters
        ----------
        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        card : CardVerificationRequestCard
            Polymorphic object that contains payment details.

        operator : typing.Optional[str]
            Operator who requested to verify the card.

        customer : typing.Optional[Customer]

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CardVerificationResult
            Successful request. Returns the verification status of the card details.

        Examples
        --------
        from payroc import CardPayloadCardDetails_Raw, Device, Payroc
        from payroc.payment_features.cards import CardVerificationRequestCard_Card

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.payment_features.cards.verify_card(
            idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
            processing_terminal_id="1234001",
            operator="Jane",
            card=CardVerificationRequestCard_Card(
                card_details=CardPayloadCardDetails_Raw(
                    device=Device(
                        model="bbposChp",
                        serial_number="1850010868",
                    ),
                    raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                ),
            ),
        )
        """
        _response = self._raw_client.verify_card(
            idempotency_key=idempotency_key,
            processing_terminal_id=processing_terminal_id,
            card=card,
            operator=operator,
            customer=customer,
            request_options=request_options,
        )
        return _response.data

    def view_ebt_balance(
        self,
        *,
        processing_terminal_id: str,
        currency: Currency,
        card: BalanceInquiryCard,
        operator: typing.Optional[str] = OMIT,
        customer: typing.Optional[Customer] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Balance:
        """
        Use this method to view the balance of an Electronic Benefit Transfer (EBT) card.

        If the request is successful, our gateway returns the current balance of an EBT card.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        currency : Currency

        card : BalanceInquiryCard
            Polymorphic object that contains payment details.

            The value of the type parameter determines which variant you should use:
            -    `card` - Payment card details
            -    `singleUseToken` - Single-use token details

        operator : typing.Optional[str]
            Operator who requested the balance inquiry.

        customer : typing.Optional[Customer]

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Balance
            Successful request. Returns the current balance of the EBT card.

        Examples
        --------
        from payroc import CardPayloadCardDetails_Raw, Device, Payroc
        from payroc.payment_features.cards import BalanceInquiryCard_Card

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.payment_features.cards.view_ebt_balance(
            processing_terminal_id="1234001",
            operator="Jane",
            currency="USD",
            card=BalanceInquiryCard_Card(
                card_details=CardPayloadCardDetails_Raw(
                    device=Device(
                        model="bbposChp",
                        serial_number="1850010868",
                    ),
                    raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                ),
            ),
        )
        """
        _response = self._raw_client.view_ebt_balance(
            processing_terminal_id=processing_terminal_id,
            currency=currency,
            card=card,
            operator=operator,
            customer=customer,
            request_options=request_options,
        )
        return _response.data

    def lookup_bin(
        self,
        *,
        card: BinLookupCard,
        processing_terminal_id: typing.Optional[str] = OMIT,
        amount: typing.Optional[int] = OMIT,
        currency: typing.Optional[Currency] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> CardInfo:
        """
        Use this method to retrieve information about a debit card, a credit card, or an EBT card. If you apply surcharges to transactions, you can also check if the card supports surcharging.

        In the response, our gateway returns the following information about the card:

        - **Card details** - Information about the card, for example, the issuing bank and the masked card number.

        - **Surcharging information** - If you apply a surcharge to transactions, our gateway checks that the card supports surcharging and returns information about the surcharge. For more information about surcharging, go to [Credit card surcharging](https://docs.payroc.com/knowledge/card-payments/credit-card-surcharging).

        Parameters
        ----------
        card : BinLookupCard
            Polymorphic object that contains payment details.

            The value of the type parameter determines which variant you should use:
            -    `card` - Payment card details
            -    `cardBin` - Bank identification number (BIN) of the payment card
            -    `secureToken` - Secure token details
            -    `digitalWallet` - Digital wallet details

        processing_terminal_id : typing.Optional[str]
            Unique identifier that we assigned to the terminal.

        amount : typing.Optional[int]
            Transaction amount that you send to check the surcharge amount. The value is in the currency's lowest denomination, for example, cents.

        currency : typing.Optional[Currency]

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CardInfo
            Successful request. Returns the BIN information.

        Examples
        --------
        from payroc import CardPayloadCardDetails_Raw, Device, Payroc
        from payroc.payment_features.cards import BinLookupCard_Card

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.payment_features.cards.lookup_bin(
            processing_terminal_id="1234001",
            card=BinLookupCard_Card(
                card_details=CardPayloadCardDetails_Raw(
                    device=Device(
                        model="bbposChp",
                        serial_number="1850010868",
                    ),
                    raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                ),
            ),
        )
        """
        _response = self._raw_client.lookup_bin(
            card=card,
            processing_terminal_id=processing_terminal_id,
            amount=amount,
            currency=currency,
            request_options=request_options,
        )
        return _response.data

    def retrieve_fx_rates(
        self,
        *,
        channel: FxRateInquiryChannel,
        processing_terminal_id: str,
        base_amount: int,
        base_currency: Currency,
        payment_method: FxRateInquiryPaymentMethod,
        operator: typing.Optional[str] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> FxRate:
        """
        > **Important:** There are restrictions on which merchants can use this method. For more information, go to [Dynamic Currency Conversion](https://docs.payroc.com/knowledge/card-payments/dynamic-currency-conversion).

        Use this method to check if a card is eligible for Dynamic Currency Conversion (DCC) and to retrieve the conversion rate for a transaction amount. DCC provides a customer with the option to use their card's currency instead of the merchant's currency, for example, in Ireland, an American customer can pay in US dollars instead of Euros.

        The request includes the following:

        - **Payment method** - Card information, a secure token, or digital wallet.
        - **Transaction information** - Amount and currency of the transaction in the merchant's currency.

        If the card is eligible for DCC, our gateway returns the transaction amount in the card's currency and a dccOffer object that contains information about the conversion rate. The dccOffer object contains the following fields that you need when you [run a sale](https://docs.payroc.com/api/schema/card-payments/payments/create) or [unreferenced refund](https://docs.payroc.com/api/schema/card-payments/refunds/create-unreferenced-refund) with DCC:
        - fxAmount
        - fxCurrency
        - fxRate
        - markup
        - accepted
        - offerReference

        Parameters
        ----------
        channel : FxRateInquiryChannel
            Channel that the merchant used to receive payment details for the transaction.

        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        base_amount : int
            Total amount of the transaction in the merchant’s currency. The value is in the currency’s lowest denomination, for example, cents.

        base_currency : Currency

        payment_method : FxRateInquiryPaymentMethod
            Polymorphic object that contains payment details.

            The value of the type parameter determines which variant you should use:
            -    `card` - Payment card details
            -    `secureToken` - Secure token details
            -    `digitalWallet` - Digital wallet details

        operator : typing.Optional[str]
            Operator who ran the transaction.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        FxRate
            Successful request. Returns the currency conversion rate for the transaction.

        Examples
        --------
        from payroc import CardPayloadCardDetails_Raw, Device, Payroc
        from payroc.payment_features.cards import FxRateInquiryPaymentMethod_Card

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.payment_features.cards.retrieve_fx_rates(
            channel="web",
            processing_terminal_id="1234001",
            operator="Jane",
            base_amount=10000,
            base_currency="USD",
            payment_method=FxRateInquiryPaymentMethod_Card(
                card_details=CardPayloadCardDetails_Raw(
                    device=Device(
                        model="bbposChp",
                        serial_number="1850010868",
                    ),
                    raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                ),
            ),
        )
        """
        _response = self._raw_client.retrieve_fx_rates(
            channel=channel,
            processing_terminal_id=processing_terminal_id,
            base_amount=base_amount,
            base_currency=base_currency,
            payment_method=payment_method,
            operator=operator,
            request_options=request_options,
        )
        return _response.data


class AsyncCardsClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawCardsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> AsyncRawCardsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawCardsClient
        """
        return self._raw_client

    async def verify_card(
        self,
        *,
        idempotency_key: str,
        processing_terminal_id: str,
        card: CardVerificationRequestCard,
        operator: typing.Optional[str] = OMIT,
        customer: typing.Optional[Customer] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> CardVerificationResult:
        """
        Use this method to verify a customer’s card details.

        In the request, send the customer’s card details.

        In the response, our gateway indicates if the card details are valid and if you should use them in follow-on actions.

        Parameters
        ----------
        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        card : CardVerificationRequestCard
            Polymorphic object that contains payment details.

        operator : typing.Optional[str]
            Operator who requested to verify the card.

        customer : typing.Optional[Customer]

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CardVerificationResult
            Successful request. Returns the verification status of the card details.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc, CardPayloadCardDetails_Raw, Device
        from payroc.payment_features.cards import CardVerificationRequestCard_Card

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.payment_features.cards.verify_card(
                idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
                processing_terminal_id="1234001",
                operator="Jane",
                card=CardVerificationRequestCard_Card(
                    card_details=CardPayloadCardDetails_Raw(
                        device=Device(
                            model="bbposChp",
                            serial_number="1850010868",
                        ),
                        raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                    ),
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.verify_card(
            idempotency_key=idempotency_key,
            processing_terminal_id=processing_terminal_id,
            card=card,
            operator=operator,
            customer=customer,
            request_options=request_options,
        )
        return _response.data

    async def view_ebt_balance(
        self,
        *,
        processing_terminal_id: str,
        currency: Currency,
        card: BalanceInquiryCard,
        operator: typing.Optional[str] = OMIT,
        customer: typing.Optional[Customer] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Balance:
        """
        Use this method to view the balance of an Electronic Benefit Transfer (EBT) card.

        If the request is successful, our gateway returns the current balance of an EBT card.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        currency : Currency

        card : BalanceInquiryCard
            Polymorphic object that contains payment details.

            The value of the type parameter determines which variant you should use:
            -    `card` - Payment card details
            -    `singleUseToken` - Single-use token details

        operator : typing.Optional[str]
            Operator who requested the balance inquiry.

        customer : typing.Optional[Customer]

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Balance
            Successful request. Returns the current balance of the EBT card.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc, CardPayloadCardDetails_Raw, Device
        from payroc.payment_features.cards import BalanceInquiryCard_Card

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.payment_features.cards.view_ebt_balance(
                processing_terminal_id="1234001",
                operator="Jane",
                currency="USD",
                card=BalanceInquiryCard_Card(
                    card_details=CardPayloadCardDetails_Raw(
                        device=Device(
                            model="bbposChp",
                            serial_number="1850010868",
                        ),
                        raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                    ),
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.view_ebt_balance(
            processing_terminal_id=processing_terminal_id,
            currency=currency,
            card=card,
            operator=operator,
            customer=customer,
            request_options=request_options,
        )
        return _response.data

    async def lookup_bin(
        self,
        *,
        card: BinLookupCard,
        processing_terminal_id: typing.Optional[str] = OMIT,
        amount: typing.Optional[int] = OMIT,
        currency: typing.Optional[Currency] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> CardInfo:
        """
        Use this method to retrieve information about a debit card, a credit card, or an EBT card. If you apply surcharges to transactions, you can also check if the card supports surcharging.

        In the response, our gateway returns the following information about the card:

        - **Card details** - Information about the card, for example, the issuing bank and the masked card number.

        - **Surcharging information** - If you apply a surcharge to transactions, our gateway checks that the card supports surcharging and returns information about the surcharge. For more information about surcharging, go to [Credit card surcharging](https://docs.payroc.com/knowledge/card-payments/credit-card-surcharging).

        Parameters
        ----------
        card : BinLookupCard
            Polymorphic object that contains payment details.

            The value of the type parameter determines which variant you should use:
            -    `card` - Payment card details
            -    `cardBin` - Bank identification number (BIN) of the payment card
            -    `secureToken` - Secure token details
            -    `digitalWallet` - Digital wallet details

        processing_terminal_id : typing.Optional[str]
            Unique identifier that we assigned to the terminal.

        amount : typing.Optional[int]
            Transaction amount that you send to check the surcharge amount. The value is in the currency's lowest denomination, for example, cents.

        currency : typing.Optional[Currency]

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        CardInfo
            Successful request. Returns the BIN information.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc, CardPayloadCardDetails_Raw, Device
        from payroc.payment_features.cards import BinLookupCard_Card

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.payment_features.cards.lookup_bin(
                processing_terminal_id="1234001",
                card=BinLookupCard_Card(
                    card_details=CardPayloadCardDetails_Raw(
                        device=Device(
                            model="bbposChp",
                            serial_number="1850010868",
                        ),
                        raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                    ),
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.lookup_bin(
            card=card,
            processing_terminal_id=processing_terminal_id,
            amount=amount,
            currency=currency,
            request_options=request_options,
        )
        return _response.data

    async def retrieve_fx_rates(
        self,
        *,
        channel: FxRateInquiryChannel,
        processing_terminal_id: str,
        base_amount: int,
        base_currency: Currency,
        payment_method: FxRateInquiryPaymentMethod,
        operator: typing.Optional[str] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> FxRate:
        """
        > **Important:** There are restrictions on which merchants can use this method. For more information, go to [Dynamic Currency Conversion](https://docs.payroc.com/knowledge/card-payments/dynamic-currency-conversion).

        Use this method to check if a card is eligible for Dynamic Currency Conversion (DCC) and to retrieve the conversion rate for a transaction amount. DCC provides a customer with the option to use their card's currency instead of the merchant's currency, for example, in Ireland, an American customer can pay in US dollars instead of Euros.

        The request includes the following:

        - **Payment method** - Card information, a secure token, or digital wallet.
        - **Transaction information** - Amount and currency of the transaction in the merchant's currency.

        If the card is eligible for DCC, our gateway returns the transaction amount in the card's currency and a dccOffer object that contains information about the conversion rate. The dccOffer object contains the following fields that you need when you [run a sale](https://docs.payroc.com/api/schema/card-payments/payments/create) or [unreferenced refund](https://docs.payroc.com/api/schema/card-payments/refunds/create-unreferenced-refund) with DCC:
        - fxAmount
        - fxCurrency
        - fxRate
        - markup
        - accepted
        - offerReference

        Parameters
        ----------
        channel : FxRateInquiryChannel
            Channel that the merchant used to receive payment details for the transaction.

        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        base_amount : int
            Total amount of the transaction in the merchant’s currency. The value is in the currency’s lowest denomination, for example, cents.

        base_currency : Currency

        payment_method : FxRateInquiryPaymentMethod
            Polymorphic object that contains payment details.

            The value of the type parameter determines which variant you should use:
            -    `card` - Payment card details
            -    `secureToken` - Secure token details
            -    `digitalWallet` - Digital wallet details

        operator : typing.Optional[str]
            Operator who ran the transaction.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        FxRate
            Successful request. Returns the currency conversion rate for the transaction.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc, CardPayloadCardDetails_Raw, Device
        from payroc.payment_features.cards import FxRateInquiryPaymentMethod_Card

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.payment_features.cards.retrieve_fx_rates(
                channel="web",
                processing_terminal_id="1234001",
                operator="Jane",
                base_amount=10000,
                base_currency="USD",
                payment_method=FxRateInquiryPaymentMethod_Card(
                    card_details=CardPayloadCardDetails_Raw(
                        device=Device(
                            model="bbposChp",
                            serial_number="1850010868",
                        ),
                        raw_data="A1B2C3D4E5F67890ABCD1234567890ABCDEF1234567890ABCDEF1234567890ABCDEF",
                    ),
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.retrieve_fx_rates(
            channel=channel,
            processing_terminal_id=processing_terminal_id,
            base_amount=base_amount,
            base_currency=base_currency,
            payment_method=payment_method,
            operator=operator,
            request_options=request_options,
        )
        return _response.data
