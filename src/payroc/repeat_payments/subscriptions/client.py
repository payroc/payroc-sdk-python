# This file was auto-generated by Fern from our API Definition.

import datetime as dt
import typing

from ...core.client_wrapper import AsyncClientWrapper, SyncClientWrapper
from ...core.custom_pagination import AsyncPayrocPager, SyncPayrocPager
from ...core.request_options import RequestOptions
from ...types.custom_field import CustomField
from ...types.patch_request import PatchRequest
from ...types.subscription import Subscription
from ...types.subscription_paginated_list import SubscriptionPaginatedList
from ...types.subscription_payment import SubscriptionPayment
from ...types.subscription_payment_order import SubscriptionPaymentOrder
from ...types.subscription_payment_order_request import SubscriptionPaymentOrderRequest
from ...types.subscription_recurring_order_request import SubscriptionRecurringOrderRequest
from .raw_client import AsyncRawSubscriptionsClient, RawSubscriptionsClient
from .types.list_subscriptions_request_frequency import ListSubscriptionsRequestFrequency
from .types.list_subscriptions_request_status import ListSubscriptionsRequestStatus
from .types.subscription_request_payment_method import SubscriptionRequestPaymentMethod

# this is used as the default value for optional parameters
OMIT = typing.cast(typing.Any, ...)


class SubscriptionsClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._raw_client = RawSubscriptionsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> RawSubscriptionsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        RawSubscriptionsClient
        """
        return self._raw_client

    def list(
        self,
        processing_terminal_id: str,
        *,
        customer_name: typing.Optional[str] = None,
        last_4: typing.Optional[str] = None,
        payment_plan: typing.Optional[str] = None,
        frequency: typing.Optional[ListSubscriptionsRequestFrequency] = None,
        status: typing.Optional[ListSubscriptionsRequestStatus] = None,
        end_date: typing.Optional[dt.date] = None,
        next_due_date: typing.Optional[dt.date] = None,
        before: typing.Optional[str] = None,
        after: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SyncPayrocPager[Subscription, SubscriptionPaginatedList]:
        """
        Use this method to return a [paginated](https://docs.payroc.com/api/pagination) list of subscriptions.

        Note: If you want to view the details of a specific subscription and you have its subscriptionId, use our [Retrieve subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/retrieve) method.

        Use query parameters to filter the list of results that we return, for example, to search for subscriptions for a customer, a payment plan, or frequency.

        Our gateway returns information about the following for each subscription in the list:

        -    Payment plan the subscription is linked to.
        -    Secure token that represents cardholder’s payment details.
        -    Current state of the subscription, including its status, next due date, and invoices.
        -    Fees for setup and the cost of the recurring order.
        -    Subscription length, end date, and frequency.

        For each subscription, we also return the subscriptionId, the paymentPlanId, and the secureTokenId, which you can use to perform follow-actions.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        customer_name : typing.Optional[str]
            Filter by the customer's name.

        last_4 : typing.Optional[str]
            Filter by the last four digits of the card or account number.

        payment_plan : typing.Optional[str]
            Filter by the name of the payment plan.

        frequency : typing.Optional[ListSubscriptionsRequestFrequency]
            Filter by the frequency of subscription payments.

        status : typing.Optional[ListSubscriptionsRequestStatus]
            Filter by the current status of the subscription.

        end_date : typing.Optional[dt.date]
            Format: `YYYY-MM-DD`
            Filter subscriptions that end on a specific date.

        next_due_date : typing.Optional[dt.date]
            Format: `YYYY-MM-DD`
            Filter subscriptions by the date that the next payment is collected.

        before : typing.Optional[str]
            Return the previous page of results before the value that you specify.

            You can’t send the before parameter in the same request as the after parameter.

        after : typing.Optional[str]
            Return the next page of results after the value that you specify.

            You can’t send the after parameter in the same request as the before parameter.

        limit : typing.Optional[int]
            Limit the maximum number of results that we return for each page.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SyncPayrocPager[Subscription, SubscriptionPaginatedList]
            Successful request. Returns a paginated list of subscriptions.

        Examples
        --------
        import datetime

        from payroc import Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        response = client.repeat_payments.subscriptions.list(
            processing_terminal_id="1234001",
            customer_name="Sarah%20Hazel%20Hopper",
            last_4="7062",
            payment_plan="Premium%20Club",
            frequency="weekly",
            status="active",
            end_date=datetime.date.fromisoformat(
                "2025-07-01",
            ),
            next_due_date=datetime.date.fromisoformat(
                "2024-08-01",
            ),
            before="2571",
            after="8516",
            limit=1,
        )
        for item in response:
            yield item
        # alternatively, you can paginate page-by-page
        for page in response.iter_pages():
            yield page
        """
        return self._raw_client.list(
            processing_terminal_id,
            customer_name=customer_name,
            last_4=last_4,
            payment_plan=payment_plan,
            frequency=frequency,
            status=status,
            end_date=end_date,
            next_due_date=next_due_date,
            before=before,
            after=after,
            limit=limit,
            request_options=request_options,
        )

    def create(
        self,
        processing_terminal_id: str,
        *,
        idempotency_key: str,
        subscription_id: str,
        payment_plan_id: str,
        payment_method: SubscriptionRequestPaymentMethod,
        start_date: dt.date,
        name: typing.Optional[str] = OMIT,
        description: typing.Optional[str] = OMIT,
        setup_order: typing.Optional[SubscriptionPaymentOrderRequest] = OMIT,
        recurring_order: typing.Optional[SubscriptionRecurringOrderRequest] = OMIT,
        end_date: typing.Optional[dt.date] = OMIT,
        length: typing.Optional[int] = OMIT,
        pause_collection_for: typing.Optional[int] = OMIT,
        custom_fields: typing.Optional[typing.Sequence[CustomField]] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to assign a customer to a payment plan.

        **Note:** This method is part of our Repeat Payments feature. To help you understand how this method works with our Payment plans endpoints, go to [Repeat Payments](https://docs.payroc.com/guides/take-payments/repeat-payments).

        When you create a subscription you need to provide a unique subscriptionId that you use to run follow-on actions:

        - [Retrieve Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/retrieve) - View the details of the subscription.
        - [Update Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/partially-update) - Update the details of the subscription.
        - [Deactivate Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/deactivate) - Stop taking payments for the subscription.
        - [Re-activate Subscription](https://docs.payroc.com/api/schema/payments/subscriptions/reactivate) - Start taking payments again for the subscription.
        - [Pay Manual Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/pay) - Manually collect a payment for the subscription.

        The request includes the following settings:
        - **paymentPlanId** - Unique identifier of the payment plan that the merchant wants to use. If you don't have the paymentPlanId, use our [List Payment Plans](https://docs.payroc.com/api/schema/repeat-payments/payment-plans/list) method to search for the payment plan.
        - **paymentMethod** - Object that contains information about the secure token, which represents the customer's card details or bank account details.
        - **startDate** - Date that you want to start to take payments.

        You can also update the settings that the subscription inherited from the payment plan, for example, you can change the amount for each payment. If you change the settings for the subscription, it doesn't change the settings in the payment plan that it's linked to.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        payment_plan_id : str
            Unique identifier that the merchant assigned to the payment plan.

        payment_method : SubscriptionRequestPaymentMethod
            Polymorphic object that contains information about the secure token.

        start_date : dt.date
            Format: **YYYY-MM-DD**
            Subscription's start date.

        name : typing.Optional[str]
            Name of the subscription.
            This value replaces the name inherited from the payment plan.

        description : typing.Optional[str]
            Description of the subscription.
            This value replaces the description inherited from the payment plan.

        setup_order : typing.Optional[SubscriptionPaymentOrderRequest]

        recurring_order : typing.Optional[SubscriptionRecurringOrderRequest]

        end_date : typing.Optional[dt.date]
            Format: **YYYY-MM-DD**
            Subscription's end date.
            **Note:** If you provide values for both **length** and **endDate**,
            our gateway uses the value for **endDate** to determine when the subscription should end.

        length : typing.Optional[int]
            Total number of billing cycles. To indicate that the subscription should run indefinitely, send a value of `0`.
            This value replaces the **length** inherited from the payment plan.
            **Note:** If you provide values for both **length** and **endDate**,
            our gateway uses the value for **endDate** to determine when the subscription should end.

        pause_collection_for : typing.Optional[int]
            Number of billing cycles that the merchant wants to pause payments for.
            For example, if the merchant wants to offer a free trial period.

        custom_fields : typing.Optional[typing.Sequence[CustomField]]
            Array of customField objects.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. We created the subscription.

        Examples
        --------
        import datetime

        from payroc import (
            Payroc,
            SubscriptionOrderBreakdownRequest,
            SubscriptionPaymentOrderRequest,
            SubscriptionRecurringOrderRequest,
            TaxRate,
        )
        from payroc.repeat_payments.subscriptions import (
            SubscriptionRequestPaymentMethod_SecureToken,
        )

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.repeat_payments.subscriptions.create(
            processing_terminal_id="1234001",
            idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
            subscription_id="SubRef7654",
            payment_plan_id="PlanRef8765",
            payment_method=SubscriptionRequestPaymentMethod_SecureToken(
                token="1234567890123456789",
            ),
            name="Premium Club",
            description="Premium Club subscription",
            setup_order=SubscriptionPaymentOrderRequest(
                order_id="OrderRef6543",
                amount=4999,
                description="Initial setup fee for Premium Club subscription",
            ),
            recurring_order=SubscriptionRecurringOrderRequest(
                amount=4999,
                description="Monthly Premium Club subscription",
                breakdown=SubscriptionOrderBreakdownRequest(
                    subtotal=4347,
                    taxes=[
                        TaxRate(
                            type="rate",
                            rate=5.0,
                            name="Sales Tax",
                        )
                    ],
                ),
            ),
            start_date=datetime.date.fromisoformat(
                "2024-07-02",
            ),
            end_date=datetime.date.fromisoformat(
                "2025-07-01",
            ),
            length=12,
            pause_collection_for=0,
        )
        """
        _response = self._raw_client.create(
            processing_terminal_id,
            idempotency_key=idempotency_key,
            subscription_id=subscription_id,
            payment_plan_id=payment_plan_id,
            payment_method=payment_method,
            start_date=start_date,
            name=name,
            description=description,
            setup_order=setup_order,
            recurring_order=recurring_order,
            end_date=end_date,
            length=length,
            pause_collection_for=pause_collection_for,
            custom_fields=custom_fields,
            request_options=request_options,
        )
        return _response.data

    def retrieve(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to retrieve information about a subscription.

        To retrieve a subscription, you need its subscriptionId. You sent the subscriptionId in the request of the [Create subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the subscription.

        Our gateway returns information about the following for the subscription:

        -    Payment plan the subscription is linked to.
        -    Secure token that represents cardholder’s payment details.
        -    Current state of the subscription, including its status, next due date, and invoices.
        -    Fees for setup and the cost of the recurring order.
        -    Subscription length, end date, and frequency.

        We also return the paymentPlanId and the secureTokenId, which you can use to perform follow-on actions.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. Returns the requested subscription.

        Examples
        --------
        from payroc import Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.repeat_payments.subscriptions.retrieve(
            processing_terminal_id="1234001",
            subscription_id="SubRef7654",
        )
        """
        _response = self._raw_client.retrieve(processing_terminal_id, subscription_id, request_options=request_options)
        return _response.data

    def partially_update(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        idempotency_key: str,
        request: PatchRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to partially update a subscription. Structure your request to follow the [RFC 6902](https://datatracker.ietf.org/doc/html/rfc6902) standard.

        To update a subscription, you need its subscriptionId, which you sent in the request of the [Create subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the payment.

        You can update all of the properties of the subscription except for the following:

        **Can't delete**
        - recurringOrder
        - description
        - name

        **Can't perform any PATCH operation**
        - currentState
        - type
        - frequency
        - paymentPlan

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        request : PatchRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. We have updated the subscription.

        Examples
        --------
        from payroc import PatchDocument_Remove, Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.repeat_payments.subscriptions.partially_update(
            processing_terminal_id="1234001",
            subscription_id="SubRef7654",
            idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
            request=[
                PatchDocument_Remove(
                    path="path",
                ),
                PatchDocument_Remove(
                    path="path",
                ),
                PatchDocument_Remove(
                    path="path",
                ),
            ],
        )
        """
        _response = self._raw_client.partially_update(
            processing_terminal_id,
            subscription_id,
            idempotency_key=idempotency_key,
            request=request,
            request_options=request_options,
        )
        return _response.data

    def deactivate(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to deactivate a subscription.

        To deactivate a subscription, you need its subscriptionId, which you sent in the request of the [Create Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List Subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the subscription.

        If your request is successful, our gateway stops taking payments from the customer.

        To reactivate the subscription, use our [Reactivate Subscription](https://docs.payroc.com/api/schema/payments/subscriptions/reactivate) method.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. We deactivated the subscription.

        Examples
        --------
        from payroc import Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.repeat_payments.subscriptions.deactivate(
            processing_terminal_id="1234001",
            subscription_id="SubRef7654",
        )
        """
        _response = self._raw_client.deactivate(
            processing_terminal_id, subscription_id, request_options=request_options
        )
        return _response.data

    def reactivate(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to reactivate a subscription.

        To reactivate a subscription, you need its subscriptionId, which you sent in the request of the [Create Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List Subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the subscription.

        If your request is successful, our gateway restarts taking payments from the customer.

        To deactivate the subscription, use our [Deactivate Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/deactivate) method.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. We re-activated the subscription.

        Examples
        --------
        from payroc import Payroc

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.repeat_payments.subscriptions.reactivate(
            processing_terminal_id="1234001",
            subscription_id="SubRef7654",
        )
        """
        _response = self._raw_client.reactivate(
            processing_terminal_id, subscription_id, request_options=request_options
        )
        return _response.data

    def pay(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        idempotency_key: str,
        order: SubscriptionPaymentOrder,
        operator: typing.Optional[str] = OMIT,
        custom_fields: typing.Optional[typing.Sequence[CustomField]] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SubscriptionPayment:
        """
        Use this method to manually collect a payment linked to a subscription. You can manually collect a payment only if the merchant chose not to let our gateway automatically collect each payment.

        To manually collect a payment, you need the subscriptionId of the subscription that's linked to the payment. You sent the subscriptionId in the request of the [Create Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List Subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the subscription.

        The request includes an order object that contains information about the amount that you want to collect.

        In the response, our gateway returns information about the payment and a paymentId. You can use the paymentId in follow-on actions with the [Payments](https://docs.payroc.com/api/schema/card-payments/payments) endpoints or [Bank Transfer Payments](https://docs.payroc.com/api/schema/bank-transfer-payments/payments) endpoints.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        order : SubscriptionPaymentOrder
            Object that contains information about the payment.

        operator : typing.Optional[str]
            Operator who initiated the request.

        custom_fields : typing.Optional[typing.Sequence[CustomField]]
            Array of customField objects.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SubscriptionPayment
            Successful request. We have processed the payment for the subscription.

        Examples
        --------
        from payroc import Payroc, SubscriptionPaymentOrder

        client = Payroc(
            api_key="YOUR_API_KEY",
        )
        client.repeat_payments.subscriptions.pay(
            processing_terminal_id="1234001",
            subscription_id="SubRef7654",
            idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
            operator="Jane",
            order=SubscriptionPaymentOrder(
                order_id="OrderRef6543",
                amount=4999,
                description="Monthly Premium Club subscription",
            ),
        )
        """
        _response = self._raw_client.pay(
            processing_terminal_id,
            subscription_id,
            idempotency_key=idempotency_key,
            order=order,
            operator=operator,
            custom_fields=custom_fields,
            request_options=request_options,
        )
        return _response.data


class AsyncSubscriptionsClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._raw_client = AsyncRawSubscriptionsClient(client_wrapper=client_wrapper)

    @property
    def with_raw_response(self) -> AsyncRawSubscriptionsClient:
        """
        Retrieves a raw implementation of this client that returns raw responses.

        Returns
        -------
        AsyncRawSubscriptionsClient
        """
        return self._raw_client

    async def list(
        self,
        processing_terminal_id: str,
        *,
        customer_name: typing.Optional[str] = None,
        last_4: typing.Optional[str] = None,
        payment_plan: typing.Optional[str] = None,
        frequency: typing.Optional[ListSubscriptionsRequestFrequency] = None,
        status: typing.Optional[ListSubscriptionsRequestStatus] = None,
        end_date: typing.Optional[dt.date] = None,
        next_due_date: typing.Optional[dt.date] = None,
        before: typing.Optional[str] = None,
        after: typing.Optional[str] = None,
        limit: typing.Optional[int] = None,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> AsyncPayrocPager[Subscription, SubscriptionPaginatedList]:
        """
        Use this method to return a [paginated](https://docs.payroc.com/api/pagination) list of subscriptions.

        Note: If you want to view the details of a specific subscription and you have its subscriptionId, use our [Retrieve subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/retrieve) method.

        Use query parameters to filter the list of results that we return, for example, to search for subscriptions for a customer, a payment plan, or frequency.

        Our gateway returns information about the following for each subscription in the list:

        -    Payment plan the subscription is linked to.
        -    Secure token that represents cardholder’s payment details.
        -    Current state of the subscription, including its status, next due date, and invoices.
        -    Fees for setup and the cost of the recurring order.
        -    Subscription length, end date, and frequency.

        For each subscription, we also return the subscriptionId, the paymentPlanId, and the secureTokenId, which you can use to perform follow-actions.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        customer_name : typing.Optional[str]
            Filter by the customer's name.

        last_4 : typing.Optional[str]
            Filter by the last four digits of the card or account number.

        payment_plan : typing.Optional[str]
            Filter by the name of the payment plan.

        frequency : typing.Optional[ListSubscriptionsRequestFrequency]
            Filter by the frequency of subscription payments.

        status : typing.Optional[ListSubscriptionsRequestStatus]
            Filter by the current status of the subscription.

        end_date : typing.Optional[dt.date]
            Format: `YYYY-MM-DD`
            Filter subscriptions that end on a specific date.

        next_due_date : typing.Optional[dt.date]
            Format: `YYYY-MM-DD`
            Filter subscriptions by the date that the next payment is collected.

        before : typing.Optional[str]
            Return the previous page of results before the value that you specify.

            You can’t send the before parameter in the same request as the after parameter.

        after : typing.Optional[str]
            Return the next page of results after the value that you specify.

            You can’t send the after parameter in the same request as the before parameter.

        limit : typing.Optional[int]
            Limit the maximum number of results that we return for each page.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        AsyncPayrocPager[Subscription, SubscriptionPaginatedList]
            Successful request. Returns a paginated list of subscriptions.

        Examples
        --------
        import asyncio
        import datetime

        from payroc import AsyncPayroc

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            response = await client.repeat_payments.subscriptions.list(
                processing_terminal_id="1234001",
                customer_name="Sarah%20Hazel%20Hopper",
                last_4="7062",
                payment_plan="Premium%20Club",
                frequency="weekly",
                status="active",
                end_date=datetime.date.fromisoformat(
                    "2025-07-01",
                ),
                next_due_date=datetime.date.fromisoformat(
                    "2024-08-01",
                ),
                before="2571",
                after="8516",
                limit=1,
            )
            async for item in response:
                yield item

            # alternatively, you can paginate page-by-page
            async for page in response.iter_pages():
                yield page


        asyncio.run(main())
        """
        return await self._raw_client.list(
            processing_terminal_id,
            customer_name=customer_name,
            last_4=last_4,
            payment_plan=payment_plan,
            frequency=frequency,
            status=status,
            end_date=end_date,
            next_due_date=next_due_date,
            before=before,
            after=after,
            limit=limit,
            request_options=request_options,
        )

    async def create(
        self,
        processing_terminal_id: str,
        *,
        idempotency_key: str,
        subscription_id: str,
        payment_plan_id: str,
        payment_method: SubscriptionRequestPaymentMethod,
        start_date: dt.date,
        name: typing.Optional[str] = OMIT,
        description: typing.Optional[str] = OMIT,
        setup_order: typing.Optional[SubscriptionPaymentOrderRequest] = OMIT,
        recurring_order: typing.Optional[SubscriptionRecurringOrderRequest] = OMIT,
        end_date: typing.Optional[dt.date] = OMIT,
        length: typing.Optional[int] = OMIT,
        pause_collection_for: typing.Optional[int] = OMIT,
        custom_fields: typing.Optional[typing.Sequence[CustomField]] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to assign a customer to a payment plan.

        **Note:** This method is part of our Repeat Payments feature. To help you understand how this method works with our Payment plans endpoints, go to [Repeat Payments](https://docs.payroc.com/guides/take-payments/repeat-payments).

        When you create a subscription you need to provide a unique subscriptionId that you use to run follow-on actions:

        - [Retrieve Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/retrieve) - View the details of the subscription.
        - [Update Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/partially-update) - Update the details of the subscription.
        - [Deactivate Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/deactivate) - Stop taking payments for the subscription.
        - [Re-activate Subscription](https://docs.payroc.com/api/schema/payments/subscriptions/reactivate) - Start taking payments again for the subscription.
        - [Pay Manual Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/pay) - Manually collect a payment for the subscription.

        The request includes the following settings:
        - **paymentPlanId** - Unique identifier of the payment plan that the merchant wants to use. If you don't have the paymentPlanId, use our [List Payment Plans](https://docs.payroc.com/api/schema/repeat-payments/payment-plans/list) method to search for the payment plan.
        - **paymentMethod** - Object that contains information about the secure token, which represents the customer's card details or bank account details.
        - **startDate** - Date that you want to start to take payments.

        You can also update the settings that the subscription inherited from the payment plan, for example, you can change the amount for each payment. If you change the settings for the subscription, it doesn't change the settings in the payment plan that it's linked to.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        payment_plan_id : str
            Unique identifier that the merchant assigned to the payment plan.

        payment_method : SubscriptionRequestPaymentMethod
            Polymorphic object that contains information about the secure token.

        start_date : dt.date
            Format: **YYYY-MM-DD**
            Subscription's start date.

        name : typing.Optional[str]
            Name of the subscription.
            This value replaces the name inherited from the payment plan.

        description : typing.Optional[str]
            Description of the subscription.
            This value replaces the description inherited from the payment plan.

        setup_order : typing.Optional[SubscriptionPaymentOrderRequest]

        recurring_order : typing.Optional[SubscriptionRecurringOrderRequest]

        end_date : typing.Optional[dt.date]
            Format: **YYYY-MM-DD**
            Subscription's end date.
            **Note:** If you provide values for both **length** and **endDate**,
            our gateway uses the value for **endDate** to determine when the subscription should end.

        length : typing.Optional[int]
            Total number of billing cycles. To indicate that the subscription should run indefinitely, send a value of `0`.
            This value replaces the **length** inherited from the payment plan.
            **Note:** If you provide values for both **length** and **endDate**,
            our gateway uses the value for **endDate** to determine when the subscription should end.

        pause_collection_for : typing.Optional[int]
            Number of billing cycles that the merchant wants to pause payments for.
            For example, if the merchant wants to offer a free trial period.

        custom_fields : typing.Optional[typing.Sequence[CustomField]]
            Array of customField objects.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. We created the subscription.

        Examples
        --------
        import asyncio
        import datetime

        from payroc import (
            AsyncPayroc,
            SubscriptionOrderBreakdownRequest,
            SubscriptionPaymentOrderRequest,
            SubscriptionRecurringOrderRequest,
            TaxRate,
        )
        from payroc.repeat_payments.subscriptions import (
            SubscriptionRequestPaymentMethod_SecureToken,
        )

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.repeat_payments.subscriptions.create(
                processing_terminal_id="1234001",
                idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
                subscription_id="SubRef7654",
                payment_plan_id="PlanRef8765",
                payment_method=SubscriptionRequestPaymentMethod_SecureToken(
                    token="1234567890123456789",
                ),
                name="Premium Club",
                description="Premium Club subscription",
                setup_order=SubscriptionPaymentOrderRequest(
                    order_id="OrderRef6543",
                    amount=4999,
                    description="Initial setup fee for Premium Club subscription",
                ),
                recurring_order=SubscriptionRecurringOrderRequest(
                    amount=4999,
                    description="Monthly Premium Club subscription",
                    breakdown=SubscriptionOrderBreakdownRequest(
                        subtotal=4347,
                        taxes=[
                            TaxRate(
                                type="rate",
                                rate=5.0,
                                name="Sales Tax",
                            )
                        ],
                    ),
                ),
                start_date=datetime.date.fromisoformat(
                    "2024-07-02",
                ),
                end_date=datetime.date.fromisoformat(
                    "2025-07-01",
                ),
                length=12,
                pause_collection_for=0,
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.create(
            processing_terminal_id,
            idempotency_key=idempotency_key,
            subscription_id=subscription_id,
            payment_plan_id=payment_plan_id,
            payment_method=payment_method,
            start_date=start_date,
            name=name,
            description=description,
            setup_order=setup_order,
            recurring_order=recurring_order,
            end_date=end_date,
            length=length,
            pause_collection_for=pause_collection_for,
            custom_fields=custom_fields,
            request_options=request_options,
        )
        return _response.data

    async def retrieve(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to retrieve information about a subscription.

        To retrieve a subscription, you need its subscriptionId. You sent the subscriptionId in the request of the [Create subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the subscription.

        Our gateway returns information about the following for the subscription:

        -    Payment plan the subscription is linked to.
        -    Secure token that represents cardholder’s payment details.
        -    Current state of the subscription, including its status, next due date, and invoices.
        -    Fees for setup and the cost of the recurring order.
        -    Subscription length, end date, and frequency.

        We also return the paymentPlanId and the secureTokenId, which you can use to perform follow-on actions.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. Returns the requested subscription.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.repeat_payments.subscriptions.retrieve(
                processing_terminal_id="1234001",
                subscription_id="SubRef7654",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.retrieve(
            processing_terminal_id, subscription_id, request_options=request_options
        )
        return _response.data

    async def partially_update(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        idempotency_key: str,
        request: PatchRequest,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to partially update a subscription. Structure your request to follow the [RFC 6902](https://datatracker.ietf.org/doc/html/rfc6902) standard.

        To update a subscription, you need its subscriptionId, which you sent in the request of the [Create subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the payment.

        You can update all of the properties of the subscription except for the following:

        **Can't delete**
        - recurringOrder
        - description
        - name

        **Can't perform any PATCH operation**
        - currentState
        - type
        - frequency
        - paymentPlan

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        request : PatchRequest

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. We have updated the subscription.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc, PatchDocument_Remove

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.repeat_payments.subscriptions.partially_update(
                processing_terminal_id="1234001",
                subscription_id="SubRef7654",
                idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
                request=[
                    PatchDocument_Remove(
                        path="path",
                    ),
                    PatchDocument_Remove(
                        path="path",
                    ),
                    PatchDocument_Remove(
                        path="path",
                    ),
                ],
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.partially_update(
            processing_terminal_id,
            subscription_id,
            idempotency_key=idempotency_key,
            request=request,
            request_options=request_options,
        )
        return _response.data

    async def deactivate(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to deactivate a subscription.

        To deactivate a subscription, you need its subscriptionId, which you sent in the request of the [Create Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List Subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the subscription.

        If your request is successful, our gateway stops taking payments from the customer.

        To reactivate the subscription, use our [Reactivate Subscription](https://docs.payroc.com/api/schema/payments/subscriptions/reactivate) method.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. We deactivated the subscription.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.repeat_payments.subscriptions.deactivate(
                processing_terminal_id="1234001",
                subscription_id="SubRef7654",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.deactivate(
            processing_terminal_id, subscription_id, request_options=request_options
        )
        return _response.data

    async def reactivate(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> Subscription:
        """
        Use this method to reactivate a subscription.

        To reactivate a subscription, you need its subscriptionId, which you sent in the request of the [Create Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List Subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the subscription.

        If your request is successful, our gateway restarts taking payments from the customer.

        To deactivate the subscription, use our [Deactivate Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/deactivate) method.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        Subscription
            Successful request. We re-activated the subscription.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.repeat_payments.subscriptions.reactivate(
                processing_terminal_id="1234001",
                subscription_id="SubRef7654",
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.reactivate(
            processing_terminal_id, subscription_id, request_options=request_options
        )
        return _response.data

    async def pay(
        self,
        processing_terminal_id: str,
        subscription_id: str,
        *,
        idempotency_key: str,
        order: SubscriptionPaymentOrder,
        operator: typing.Optional[str] = OMIT,
        custom_fields: typing.Optional[typing.Sequence[CustomField]] = OMIT,
        request_options: typing.Optional[RequestOptions] = None,
    ) -> SubscriptionPayment:
        """
        Use this method to manually collect a payment linked to a subscription. You can manually collect a payment only if the merchant chose not to let our gateway automatically collect each payment.

        To manually collect a payment, you need the subscriptionId of the subscription that's linked to the payment. You sent the subscriptionId in the request of the [Create Subscription](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/create) method.

        **Note:** If you don't have the subscriptionId, use our [List Subscriptions](https://docs.payroc.com/api/schema/repeat-payments/subscriptions/list) method to search for the subscription.

        The request includes an order object that contains information about the amount that you want to collect.

        In the response, our gateway returns information about the payment and a paymentId. You can use the paymentId in follow-on actions with the [Payments](https://docs.payroc.com/api/schema/card-payments/payments) endpoints or [Bank Transfer Payments](https://docs.payroc.com/api/schema/bank-transfer-payments/payments) endpoints.

        Parameters
        ----------
        processing_terminal_id : str
            Unique identifier that we assigned to the terminal.

        subscription_id : str
            Unique identifier that the merchant assigned to the subscription.

        idempotency_key : str
            Unique identifier that you generate for each request. You must use the [UUID v4 format](https://www.rfc-editor.org/rfc/rfc4122) for the identifier. For more information about the idempotency key, go to [Idempotency](https://docs.payroc.com/api/idempotency).

        order : SubscriptionPaymentOrder
            Object that contains information about the payment.

        operator : typing.Optional[str]
            Operator who initiated the request.

        custom_fields : typing.Optional[typing.Sequence[CustomField]]
            Array of customField objects.

        request_options : typing.Optional[RequestOptions]
            Request-specific configuration.

        Returns
        -------
        SubscriptionPayment
            Successful request. We have processed the payment for the subscription.

        Examples
        --------
        import asyncio

        from payroc import AsyncPayroc, SubscriptionPaymentOrder

        client = AsyncPayroc(
            api_key="YOUR_API_KEY",
        )


        async def main() -> None:
            await client.repeat_payments.subscriptions.pay(
                processing_terminal_id="1234001",
                subscription_id="SubRef7654",
                idempotency_key="8e03978e-40d5-43e8-bc93-6894a57f9324",
                operator="Jane",
                order=SubscriptionPaymentOrder(
                    order_id="OrderRef6543",
                    amount=4999,
                    description="Monthly Premium Club subscription",
                ),
            )


        asyncio.run(main())
        """
        _response = await self._raw_client.pay(
            processing_terminal_id,
            subscription_id,
            idempotency_key=idempotency_key,
            order=order,
            operator=operator,
            custom_fields=custom_fields,
            request_options=request_options,
        )
        return _response.data
